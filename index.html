<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ana - Personal Trainer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        .page { display: none; }
    </style>
</head>
<body class="w-full min-h-screen">

    <div id="login-screen" class="page flex items-center justify-center min-h-screen p-4">
        <div class="w-full max-w-sm">
            <div class="bg-white shadow-xl rounded-xl p-8">
                <div class="text-center mb-6">
                    <h1 class="text-2xl font-bold text-gray-800">Acesso Restrito</h1>
                    <p class="text-gray-500">Entre com suas credenciais.</p>
                </div>
                <form id="login-form">
                    <div class="mb-4">
                        <label for="username" class="block text-gray-700 text-sm font-bold mb-2">Usuário / E-mail</label>
                        <input id="username" type="text" value="ana" class="shadow-sm appearance-none border rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div class="mb-6">
                        <label for="password" class="block text-gray-700 text-sm font-bold mb-2">Senha</label>
                        <input id="password" type="password" value="1234" class="shadow-sm appearance-none border rounded-lg w-full py-3 px-4 text-gray-700 mb-3 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg focus:outline-none focus:shadow-outline transition-colors">
                        Entrar
                    </button>
                </form>
            </div>
        </div>
    </div>

    <div id="dashboard-screen" class="page w-full h-full">
        <header class="bg-white shadow-md p-4 flex justify-between items-center">
            <h1 class="text-xl font-bold text-gray-800">Painel da Personal</h1>
            <button id="logout-button" class="text-sm text-blue-600 hover:underline">Sair</button>
        </header>
        
        <main class="p-8">
            <h2 class="text-2xl font-bold text-gray-700 mb-6">Visão Geral</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <div id="add-aluno-card" class="bg-white p-6 rounded-xl shadow hover:shadow-lg transition-shadow cursor-pointer"><i class="fas fa-user-plus text-3xl text-blue-500 mb-4"></i><h2 class="text-lg font-bold">Adicionar Aluno</h2><p class="text-gray-600">Cadastre um novo aluno na sua base.</p></div>
                <div id="meus-alunos-card" class="bg-white p-6 rounded-xl shadow hover:shadow-lg transition-shadow cursor-pointer"><i class="fas fa-users text-3xl text-green-500 mb-4"></i><h2 class="text-lg font-bold">Meus Alunos</h2><p class="text-gray-600">Visualize e gerencie seus alunos.</p></div>
                <div id="montar-treino-card" class="bg-white p-6 rounded-xl shadow hover:shadow-lg transition-shadow cursor-pointer"><i class="fas fa-dumbbell text-3xl text-purple-500 mb-4"></i><h2 class="text-lg font-bold">Montar Treino</h2><p class="text-gray-600">Crie um novo plano de treino.</p></div>
            </div>
        </main>
    </div>
    
    <div id="alunos-screen" class="page w-full h-full">
        <header class="bg-white shadow-md p-4 flex justify-between items-center">
            <h1 class="text-xl font-bold text-gray-800">Meus Alunos</h1>
            <button class="back-to-dashboard text-sm text-blue-600 hover:underline">&larr; Voltar ao Painel</button>
        </header>
        <main class="p-8">
            <div id="lista-de-alunos-container" class="bg-white rounded-xl shadow p-6">
                <p>Carregando alunos...</p>
            </div>
        </main>
    </div>

    <div id="add-aluno-screen" class="page w-full h-full">
        <header class="bg-white shadow-md p-4 flex justify-between items-center">
            <h1 class="text-xl font-bold text-gray-800">Adicionar Novo Aluno</h1>
            <button class="back-to-dashboard text-sm text-blue-600 hover:underline">&larr; Voltar ao Painel</button>
        </header>
        <main class="p-8">
            <div class="max-w-xl mx-auto bg-white rounded-xl shadow p-8">
                <form id="add-aluno-form">
                    <div class="mb-4">
                        <label for="nome-aluno" class="block text-gray-700 text-sm font-bold mb-2">Nome Completo</label>
                        <input id="nome-aluno" type="text" required class="shadow-sm appearance-none border rounded-lg w-full py-3 px-4 text-gray-700">
                    </div>
                    <div class="mb-4">
                        <label for="email-aluno" class="block text-gray-700 text-sm font-bold mb-2">E-mail</label>
                        <input id="email-aluno" type="email" required class="shadow-sm appearance-none border rounded-lg w-full py-3 px-4 text-gray-700">
                    </div>
                    <div class="mb-6">
                        <label for="senha-aluno" class="block text-gray-700 text-sm font-bold mb-2">Senha Provisória</label>
                        <input id="senha-aluno" type="password" required class="shadow-sm appearance-none border rounded-lg w-full py-3 px-4 text-gray-700">
                    </div>
                    <p id="add-aluno-message" class="text-center mb-4 font-bold" style="display: none;"></p>
                    <button type="submit" id="add-aluno-button" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg">Salvar Aluno</button>
                </form>
            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- SUAS CREDENCIAIS DO AIRTABLE ---
            const AIRTABLE_API_KEY = 'patIf3xcHjeT8DGQ1.6846b6f3e9465027231c5fe072a739a953928da2844e2878c3f5f4e269bfbf6a';
            const AIRTABLE_BASE_ID = 'appGe2ffDg4GmsfKu';
            // ------------------------------------

            // --- Nossos Elementos HTML ---
            const pages = {
                login: document.getElementById('login-screen'),
                dashboard: document.getElementById('dashboard-screen'),
                alunos: document.getElementById('alunos-screen'),
                addAluno: document.getElementById('add-aluno-screen')
            };
            const loginForm = document.getElementById('login-form');
            const logoutButton = document.getElementById('logout-button');
            const meusAlunosCard = document.getElementById('meus-alunos-card');
            const addAlunoCard = document.getElementById('add-aluno-card');
            const backButtons = document.querySelectorAll('.back-to-dashboard');
            const listaDeAlunosContainer = document.getElementById('lista-de-alunos-container');
            const addAlunoForm = document.getElementById('add-aluno-form');

            // --- Nossas Funções ---
            function showPage(pageName) {
                for (let pageId in pages) {
                    if (pages[pageId]) pages[pageId].style.display = 'none';
                }
                if (pages[pageName]) {
                    pages[pageName].style.display = (pageName === 'login') ? 'flex' : 'block';
                }
            }

            async function carregarAlunos() {
                listaDeAlunosContainer.innerHTML = '<p>Carregando alunos...</p>';
                try {
                    const url = `https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/Alunos`;
                    const response = await fetch(url, { headers: { 'Authorization': `Bearer ${AIRTABLE_API_KEY}` } });
                    if (!response.ok) throw new Error('Falha ao buscar dados no Airtable.');
                    
                    const data = await response.json();
                    const alunos = data.records;

                    listaDeAlunosContainer.innerHTML = ''; 
                    if (alunos.length === 0) {
                        listaDeAlunosContainer.innerHTML = '<p>Nenhum aluno cadastrado.</p>';
                        return;
                    }

                    const table = document.createElement('table');
                    table.className = 'min-w-full divide-y divide-gray-200';
                    table.innerHTML = `<thead class="bg-gray-50"><tr><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nome</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th></tr></thead><tbody class="bg-white divide-y divide-gray-200"></tbody>`;
                    
                    const tbody = table.querySelector('tbody');
                    alunos.forEach(record => {
                        const aluno = record.fields;
                        const statusClass = aluno.status === 'Ativo' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800';
                        const row = document.createElement('tr');
                        row.innerHTML = `<td class="px-6 py-4 whitespace-nowrap">${aluno.nome_aluno || ''}</td><td class="px-6 py-4 whitespace-nowrap">${aluno.email || ''}</td><td class="px-6 py-4 whitespace-nowrap"><span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${statusClass}">${aluno.status || ''}</span></td>`;
                        tbody.appendChild(row);
                    });
                    listaDeAlunosContainer.appendChild(table);

                } catch (error) {
                    console.error('Erro ao carregar alunos:', error);
                    listaDeAlunosContainer.innerHTML = '<p class="text-red-500">Falha ao carregar a lista de alunos.</p>';
                }
            }

            async function adicionarAluno(event) {
                event.preventDefault();
                const addButton = document.getElementById('add-aluno-button');
                const messageEl = document.getElementById('add-aluno-message');
                addButton.disabled = true;
                addButton.textContent = 'Salvando...';
                messageEl.style.display = 'none';

                const alunoData = {
                    fields: {
                        "nome_aluno": document.getElementById('nome-aluno').value,
                        "email": document.getElementById('email-aluno').value,
                        "senha": document.getElementById('senha-aluno').value,
                        "status": "Ativo"
                    }
                };

                try {
                    const url = `https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/Alunos`;
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Authorization': `Bearer ${AIRTABLE_API_KEY}`, 'Content-Type': 'application/json' },
                        body: JSON.stringify(alunoData)
                    });
                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.error.message || 'Falha ao adicionar aluno.');
                    }
                    
                    messageEl.textContent = 'Aluno cadastrado com sucesso!';
                    messageEl.className = 'text-center mb-4 text-green-600';
                    addAlunoForm.reset();

                } catch (error) {
                    messageEl.textContent = 'Erro: ' + error.message;
                    messageEl.className = 'text-center mb-4 text-red-600';
                } finally {
                    messageEl.style.display = 'block';
                    addButton.disabled = false;
                    addButton.textContent = 'Salvar Aluno';
                }
            }
            
            // --- Nossos "Ouvintes de Eventos" ---
            if(loginForm) loginForm.addEventListener('submit', function(event) {
                event.preventDefault();
                if (loginForm.username.value === 'ana' && loginForm.password.value === '1234') {
                    showPage('dashboard');
                } else {
                    alert('Usuário ou senha inválidos!');
                }
            });

            if(logoutButton) logoutButton.addEventListener('click', () => showPage('login'));

            if(meusAlunosCard) meusAlunosCard.addEventListener('click', () => {
                showPage('alunos');
                carregarAlunos();
            });

            if(addAlunoCard) addAlunoCard.addEventListener('click', () => {
                showPage('addAluno');
            });
            
            if(addAlunoForm) addAlunoForm.addEventListener('submit', adicionarAluno);

            backButtons.forEach(button => {
                button.addEventListener('click', () => showPage('dashboard'));
            });

            // --- Início do App ---
            showPage('login');
        });
    </script>
</body>
</html>
